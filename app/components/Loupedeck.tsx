import React from "react";
import { motion, SVGMotionProps, Variants } from "framer-motion";
import { listen } from "@tauri-apps/api/event";
import { EventUpdatePayload } from "../types";

const LoupedeckKnob = (props: SVGMotionProps<SVGCircleElement>) => {
  const [pressed, setPressed] = React.useState(false);
  const [rotation, dispatchRotation] = React.useReducer(
    (state: number, delta: number) => {
      return state + delta;
    },
    0
  );

  React.useEffect(() => {
    const unlisten = listen<EventUpdatePayload>("event-update", (evt) => {
      if (evt.payload.ButtonPress?.button === props.id) {
        setPressed(evt.payload.ButtonPress?.dir === "Down");
      }

      if (evt.payload.KnobRotate?.knob === props.id) {
        dispatchRotation((evt.payload.KnobRotate?.value ?? 0) * 5);
      }
    });

    return () => {
      unlisten.then((l) => l());
    };
  });

  return (
    <motion.g
      animate={{
        rotate: rotation,
      }}
    >
      <motion.circle
        {...props}
        r="30.5"
        fill="#D9D9D9"
        stroke="black"
        strokeWidth="3"
        fillOpacity={0.5}
        animate={{
          fillOpacity: pressed ? 1 : 0.5,
        }}
      />
      <motion.line
        x1={props.cx}
        x2={props.cx}
        y1={Number(props.cy) - 30.5}
        y2={Number(props.cy) - 30.5 + 30.5 / 2}
        stroke="black"
        strokeWidth="3"
      />
    </motion.g>
  );
};

const LoupedeckButton = (props: SVGMotionProps<SVGCircleElement>) => {
  const [pressed, setPressed] = React.useState(false);

  React.useEffect(() => {
    const unlisten = listen<EventUpdatePayload>("event-update", (evt) => {
      if (evt.payload.ButtonPress?.button === props.id) {
        setPressed(evt.payload.ButtonPress?.dir === "Down");
      }
    });

    return () => {
      unlisten.then((l) => l());
    };
  });

  return (
    <motion.circle
      {...props}
      r="26.5"
      fill="#D9D9D9"
      fillOpacity="0.5"
      stroke="#9A1BA5"
      animate={{
        fillOpacity: pressed ? 1 : 0.5,
      }}
    />
  );
};

export const Loupedeck = () => {
  return (
    <svg
      width="693"
      height="471"
      viewBox="0 0 693 471"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <rect
        x="2.07083"
        y="2.36978"
        width="688.783"
        height="466.455"
        rx="46.5"
        fill="black"
        stroke="black"
        strokeWidth="3"
      />
      <LoupedeckKnob id="Knob5" cx="636.16" cy="295.029" />
      <LoupedeckKnob id="Knob4" cx="636.16" cy="185.194" />
      <LoupedeckKnob id="Knob3" cx="635.275" cy="74.4736" />
      <LoupedeckKnob id="Knob2" cx="59.5273" cy="295.915" />
      <LoupedeckKnob id="Knob1" cx="59.5273" cy="186.08" />
      <LoupedeckKnob id="Knob0" cx="58.6415" cy="75.3593" />
      <LoupedeckButton id="Circle7" cx="634.828" cy="379.865" />
      <path
        d="M632.396 385.365L637.6 375.07V374.979H631.6V373.729H639.055V375.047L633.873 385.365H632.396Z"
        fill="black"
      />
      <LoupedeckButton id="Circle6" cx="552.742" cy="379.865" />
      <path
        d="M553.811 385.524C553.333 385.517 552.856 385.426 552.379 385.252C551.902 385.077 551.466 384.784 551.072 384.371C550.678 383.954 550.362 383.392 550.123 382.683C549.884 381.971 549.765 381.077 549.765 380.002C549.765 378.971 549.862 378.058 550.055 377.263C550.248 376.464 550.528 375.791 550.896 375.246C551.263 374.697 551.706 374.28 552.225 373.996C552.748 373.712 553.337 373.57 553.992 373.57C554.644 373.57 555.223 373.7 555.731 373.962C556.242 374.219 556.659 374.579 556.981 375.041C557.303 375.503 557.511 376.036 557.606 376.638H556.22C556.091 376.115 555.841 375.682 555.47 375.337C555.098 374.992 554.606 374.82 553.992 374.82C553.091 374.82 552.381 375.212 551.862 375.996C551.347 376.78 551.087 377.88 551.083 379.297H551.174C551.386 378.975 551.638 378.7 551.93 378.473C552.225 378.242 552.551 378.064 552.907 377.939C553.263 377.814 553.64 377.752 554.038 377.752C554.705 377.752 555.314 377.918 555.867 378.252C556.42 378.581 556.864 379.038 557.197 379.621C557.53 380.2 557.697 380.865 557.697 381.615C557.697 382.335 557.536 382.994 557.214 383.593C556.892 384.187 556.439 384.661 555.856 385.013C555.277 385.361 554.595 385.532 553.811 385.524ZM553.811 384.274C554.288 384.274 554.716 384.155 555.095 383.916C555.477 383.678 555.778 383.358 555.998 382.956C556.222 382.555 556.333 382.108 556.333 381.615C556.333 381.134 556.225 380.697 556.009 380.303C555.797 379.905 555.504 379.589 555.129 379.354C554.758 379.119 554.333 379.002 553.856 379.002C553.496 379.002 553.161 379.074 552.85 379.218C552.54 379.358 552.267 379.551 552.032 379.797C551.801 380.043 551.619 380.325 551.487 380.644C551.354 380.958 551.288 381.289 551.288 381.638C551.288 382.1 551.396 382.532 551.612 382.933C551.831 383.335 552.131 383.659 552.509 383.905C552.892 384.151 553.326 384.274 553.811 384.274Z"
        fill="black"
      />
      <LoupedeckButton id="Circle5" cx="470.657" cy="379.865" />
      <path
        d="M471.498 385.524C470.832 385.524 470.231 385.392 469.697 385.127C469.163 384.861 468.735 384.498 468.413 384.036C468.091 383.574 467.915 383.047 467.885 382.456H469.248C469.301 382.983 469.54 383.418 469.964 383.763C470.392 384.104 470.903 384.274 471.498 384.274C471.975 384.274 472.4 384.163 472.771 383.939C473.146 383.716 473.439 383.409 473.652 383.019C473.867 382.625 473.975 382.18 473.975 381.683C473.975 381.176 473.864 380.723 473.64 380.325C473.421 379.924 473.117 379.608 472.731 379.377C472.345 379.146 471.903 379.028 471.407 379.024C471.051 379.021 470.686 379.075 470.311 379.189C469.936 379.299 469.627 379.441 469.385 379.615L468.066 379.456L468.771 373.729H474.816V374.979H469.953L469.544 378.411H469.612C469.85 378.221 470.15 378.064 470.51 377.939C470.869 377.814 471.244 377.752 471.635 377.752C472.347 377.752 472.981 377.922 473.538 378.263C474.099 378.6 474.538 379.062 474.856 379.649C475.178 380.236 475.339 380.907 475.339 381.661C475.339 382.403 475.172 383.066 474.839 383.649C474.51 384.229 474.055 384.687 473.475 385.024C472.896 385.358 472.237 385.524 471.498 385.524Z"
        fill="black"
      />
      <LoupedeckButton id="Circle4" cx="388.181" cy="379.865" />
      <path
        d="M385.113 382.979V381.82L390.227 373.729H391.068V375.524H390.499L386.636 381.638V381.729H393.522V382.979H385.113ZM390.59 385.365V382.627V382.087V373.729H391.931V385.365H390.59Z"
        fill="black"
      />
      <LoupedeckButton id="Circle3" cx="306.487" cy="379.865" />
      <path
        d="M307.623 385.524C306.873 385.524 306.205 385.396 305.618 385.138C305.034 384.88 304.57 384.522 304.226 384.064C303.885 383.602 303.699 383.066 303.669 382.456H305.101C305.131 382.831 305.26 383.155 305.487 383.428C305.714 383.697 306.012 383.905 306.379 384.053C306.746 384.2 307.154 384.274 307.601 384.274C308.101 384.274 308.544 384.187 308.93 384.013C309.316 383.839 309.62 383.596 309.839 383.286C310.059 382.975 310.169 382.615 310.169 382.206C310.169 381.778 310.063 381.401 309.851 381.075C309.638 380.746 309.328 380.488 308.919 380.303C308.51 380.117 308.01 380.024 307.419 380.024H306.487V378.774H307.419C307.881 378.774 308.286 378.691 308.635 378.524C308.987 378.358 309.262 378.123 309.459 377.82C309.659 377.517 309.76 377.161 309.76 376.752C309.76 376.358 309.673 376.015 309.498 375.723C309.324 375.432 309.078 375.204 308.76 375.041C308.445 374.878 308.074 374.797 307.646 374.797C307.245 374.797 306.866 374.871 306.51 375.019C306.157 375.163 305.87 375.373 305.646 375.649C305.423 375.922 305.301 376.252 305.282 376.638H303.919C303.941 376.028 304.125 375.494 304.47 375.036C304.815 374.574 305.265 374.214 305.822 373.956C306.383 373.699 306.998 373.57 307.669 373.57C308.388 373.57 309.006 373.716 309.521 374.007C310.036 374.295 310.432 374.676 310.709 375.149C310.985 375.623 311.123 376.134 311.123 376.683C311.123 377.339 310.951 377.897 310.606 378.36C310.265 378.822 309.801 379.142 309.214 379.32V379.411C309.949 379.532 310.523 379.844 310.936 380.348C311.349 380.848 311.555 381.468 311.555 382.206C311.555 382.839 311.383 383.407 311.038 383.911C310.697 384.411 310.231 384.805 309.64 385.093C309.049 385.38 308.377 385.524 307.623 385.524Z"
        fill="black"
      />
      <LoupedeckButton id="Circle2" cx="224.793" cy="379.865" />
      <path
        d="M221.997 385.365V384.343L225.838 380.138C226.289 379.646 226.66 379.218 226.952 378.854C227.243 378.486 227.459 378.142 227.599 377.82C227.743 377.494 227.815 377.153 227.815 376.797C227.815 376.388 227.717 376.034 227.52 375.735C227.327 375.435 227.062 375.204 226.724 375.041C226.387 374.878 226.009 374.797 225.588 374.797C225.141 374.797 224.751 374.89 224.418 375.075C224.088 375.257 223.832 375.513 223.651 375.843C223.473 376.172 223.384 376.558 223.384 377.002H222.043C222.043 376.32 222.2 375.721 222.514 375.206C222.829 374.691 223.257 374.289 223.798 374.002C224.344 373.714 224.956 373.57 225.634 373.57C226.315 373.57 226.92 373.714 227.446 374.002C227.973 374.289 228.385 374.678 228.685 375.166C228.984 375.655 229.134 376.199 229.134 376.797C229.134 377.225 229.056 377.644 228.901 378.053C228.749 378.458 228.484 378.911 228.105 379.411C227.73 379.907 227.209 380.513 226.543 381.229L223.929 384.024V384.115H229.338V385.365H221.997Z"
        fill="black"
      />
      <LoupedeckButton id="Circle1" cx="141.535" cy="379.865" />
      <path
        d="M142.83 373.729V385.365H141.421V375.206H141.353L138.512 377.093V375.661L141.421 373.729H142.83Z"
        fill="black"
      />
      <LoupedeckButton id="Home" cx="58.9979" cy="379.865" />
      <circle cx="58.9979" cy="379.865" r="9" stroke="#2C9C2A" />
      <circle cx="58.9979" cy="379.865" r="2" fill="#2C9C2A" />
      <rect
        id="screen_0_0"
        x="187.407"
        y="65.9634"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_0_1"
        x="187.407"
        y="147.848"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_0_2"
        x="187.407"
        y="229.732"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_1_0"
        x="269.407"
        y="65.9634"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_1_1"
        x="269.407"
        y="147.848"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_1_2"
        x="269.407"
        y="229.732"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_2_0"
        x="351.407"
        y="65.9634"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_2_1"
        x="351.407"
        y="147.848"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_2_2"
        x="351.407"
        y="229.732"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_3_0"
        x="433.407"
        y="65.9634"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_3_1"
        x="433.407"
        y="147.848"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_3_2"
        x="433.407"
        y="229.732"
        width="73"
        height="73.2313"
        rx="7.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
      <rect
        id="screen_left"
        x="132.327"
        y="65.9634"
        width="49.0804"
        height="237"
        rx="3.5"
        fill="#D9D9D9"
        fillOpacity="0.5"
        stroke="black"
      />
      <rect
        id="screen_right"
        x="512.407"
        y="65.9634"
        width="49.0804"
        height="237"
        rx="3.5"
        fill="#D9D9D9"
        fillOpacity="0.48"
        stroke="black"
      />
    </svg>
  );
};
